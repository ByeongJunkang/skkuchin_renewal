import { Avatar, CssBaseline, Box, ThemeProvider, Rating, Slide, Card, Badge, Typography, Grid, Container, Stack, useScrollTrigger, Button,} from '@mui/material';
import theme from '../theme/theme';
import Image from 'next/image';
import React from 'react';
import { useDispatch, useSelector } from "react-redux";
import { useRouter } from "next/router";
import { useEffect, useState } from "react"; 
import { clear_search_results } from "../actions/place/place";
import { load_rank } from '../actions/rank/rank';
import styled from '@emotion/styled';

import food from '../image/food.png';
// import circles from '../image/frames.png';
import arrow from '../image/arrow.png';
import arrowY from '../image/arrowY.png';
import arrowL from '../image/arrowLeft.png'
import arrowR from '../image/arrowRight.png'
import emptyStar from '../image/Star_border-1.png';
import filledStar from '../image/Star-1.png';
import dynamic from 'next/dynamic';

import content from '../image/magazine/magazine2/content1_1.png';
import review1_mr from '../image/magazine/review1_mr.png';
import review2_mr from '../image/magazine/review2_mr.png';
import review3_mr from '../image/magazine/review3_mr.png';
import review4_mr from '../image/magazine/review4_mr.png';
import review5_mr from '../image/magazine/review5_mr.png';

import review1_yj from '../image/magazine/review1_yj.png';
import review2_yj from '../image/magazine/review2_yj.png';
import review3_yj from '../image/magazine/review3_yj.png';
import review4_yj from '../image/magazine/review4_yj.png';
import review5_yj from '../image/magazine/review5_yj.png';

const reviewY = [
    {
        src: review1_yj,
        text: 'Íπ°Ïö∞Îèô Îñ°Î≥∂Ïù¥ Î®πÍ≥† Ïã∂Ïñ¥ Ï£ΩÎäî Ï§Ñ „Öã\nÏïåÏïÑÎì§ÏóàÏúºÎ©¥ ÎÅÑÎçïÏó¨.',
        user: 'Î∞ïÏó∞ÏßÑ/ÏãùÌíàÏÉùÎ™ÖÍ≥µÌïôÍ≥º',
        id: 115,
        rating: 5,
        
    },{
        src: review2_yj,
        text: 'Ïñë ÏßÑÏßú ÎßéÏùÄÎç∞Îã§ ÎßõÎèÑ Ï¢ãÏïÑÏöî Íµ≠Î¨º ÍπîÎÅîÌïòÍ≥† Í≤âÏ†àÏù¥ÎèÑ ÎÑàÎ¨¥ ÎßõÏûàÏóàÏäµÎãàÎã§ Ïù¥ Í∞ÄÍ≤©Ïóê Ïù¥ Ï†ïÎèÑ ÌÄÑÎ¶¨Ìã∞Î©¥ Ï†ïÎßê...üëçüëç',
        user: 'ÏãùÏùÄÎñ°/ÏûêÏó∞Í≥ºÌïôÍ≥ÑÏó¥',
        id: 181,
        rating: 4,
    },{
        src: review3_yj,
        text: 'ÎÇ≠Îßå ÏûàÎÑ§Ïöî ÏàòÏú°ÌäÄÍπÄÏùÄ Ïñ∏Ï†ú Î®πÏñ¥ÎèÑ ÏßÑÏßú Ï°¥Îßõ „Ö† ÌîºÏπòÌïòÏù¥Î≥ºÎèÑ ÎßõÏûàÏñ¥Ïöî!! ÏãúÍ∑∏ÎãàÏ≤ò ÌïòÏù¥Î≥ºÏùÄ ÏÉùÍ∞ÅÎ≥¥Îã§ ÏéÑÎÑ§Ïö• ..',
        user: 'ÎÇ≠ÎßåÌåå/Ïª¨Ï≤òÏï§ÌÖåÌÅ¨ÎÜÄÎ°úÏßÄÏúµÌï©Ï†ÑÍ≥µ',
        id: 204,
        rating: 5,
    },{
        src: review4_yj,
        text: 'ÏßÑÏßú Ïù¥Ï†ïÎèÑ Í∞ÄÍ≤©Ïóê Ïù¥Ï†ïÎèÑ ÌÄÑÎ¶¨Ìã∞Î•º Î®πÏùÑ Ïàò ÏûàÎäî Í≤å ÎÑàÎ¨¥ Ï¢ãÏïÑÏöî!! Îã§Îßå ÏïÑÏπ® 9ÏãúÏóê Ï†ÑÌôîÌï¥ÏÑú ÏòàÏïΩÏùÑ Ìï¥ÏïºÌïúÎã§Îäî Ï†ê‚Ä¶',
        user: 'ÏóêÎÑàÏûêÏù¥Ï†∏/ÌôîÌïôÍ≥º',
        id: 90,
        rating: 5,
    },{
        src: review5_yj,
        text: 'Í∏∞Î≥∏ÏúºÎ°ú Ï£ºÏãúÎäî ÎùºÎ©¥Ïù¥ ÎÑàÎ¨¥ ÎßõÏûàÏñ¥Ïöî.\nÏ†ÄÌù¨Îäî 3Î™ÖÏóêÏÑú Ïú†Î¶∞Í∏∞Îûë Îñ°Î≥∂Ïù¥ ÏãúÏº∞ÎäîÎç∞\nÍ∞ÄÍ≤©ÎèÑ Ìï©Î¶¨Ï†ÅÏù¥Í≥† ÎßõÎèÑ ÏûàÏóàÏñ¥Ïöî. Ï∂îÏ≤ú!!',
        user: 'Bakbak/Í≤ΩÏòÅÌïôÍ≥º',
        id: 209,
        rating: 5,
    },
];

const reviewM = [
    {
        src: review1_mr,
        text: 'Î™áÎ≤àÏî© Í∞à Ï†ïÎèÑÎ°ú ÎßõÏûàÏñ¥Ïöî!\nÌäπÌûà ÏπòÌÇ® Î¶¨Ï°∞ÎòêÎäî Ìï®Íªò Í∞Ñ ÏÇ¨ÎûåÎì§ Î™®Îëê Ïπ≠Ï∞¨Ìï† Ï†ïÎèÑÏòÄÎãµÎãàÎãπ.... Ï†ïÎ¨∏ Î∞îÎ°ú ÏïûÏóê ÏûàÏñ¥ÏÑú ÏúÑÏπòÎèÑ ÏµúÍ≥†ÏòàÏö§‡∑Ü‚ó°Ãà‡∑Ü',
        user: 'ÎèÑÎ¶¨/Í∏ÄÎ°úÎ≤åÍ≤ΩÏòÅÌïôÍ≥º',
        id: 323,
        rating: 5,
    },{
        src: review2_mr,
        text: 'Î™®Îì† Î©îÎâ¥Í∞Ä ÎßõÏûàÏñ¥Ïöî!!!! Ï∞®Îèå Îì§Í∏∞Î¶Ñ Íµ≠Ïàò, Î™ÖÎûÄ ÏàúÎëêÎ∂ÄÏ∞åÍ∞ú Ï∂îÏ≤úÌï©ÎãàÎãπ',
        user: 'Ìè¨ÌÇ§Ï°∞Îãà/Î¨∏ÌóåÏ†ïÎ≥¥ÌïôÍ≥º',
        id: 8,
        rating: 5,
    },{
        src: review3_mr,
        text: 'ÏÜåÎ∞î ÎßõÏûàÏñ¥Ïöî. Ï∞®Ïäà Ï∂îÍ∞ÄÌï¥ÏÑú ÎìúÏÑ∏Ïöî!!\nÌòºÎ∞• Ìï† Ïàò ÏûàÎäî ÏûêÎ¶¨Í∞Ä Îî∞Î°ú ÏûàÏúºÎãå Ï∞∏Í≥†ÌïòÏãúÎ©¥ Ï¢ãÏùÑ Í±∞ Í∞ôÏïÑÏöî',
        user: 'Bakbak/Ïª¨Ï≤òÏï§ÌÖåÌÅ¨ÎÜÄÎ°úÏßÄÏúµÌï©Ï†ÑÍ≥µ',
        id: 2,
        rating: 4,
    },{
        src: review4_mr,
        text: 'Ïà†ÏùÑ Ïïà ÏãúÌÇ¨Ïàò ÏóÜÎäî Î©îÎâ¥ÏôÄ Îßõ\nÏù¥ ÏãùÎãπÏùÄ Ï¢ãÏùÄ Í∏∞ÏñµÎ∞ñÏóê ÏóÜÎã§üëçüèª',
        user: 'qoxit_/Í≤ΩÏòÅÌïôÍ≥º',
        id: 49,
        rating: 5,
    },{
        src: review5_mr,
        text: 'ÎÑàÎ¨¥ÎÑàÎ¨¥ ÎßõÏûàÏñ¥Ïöî Ïñ¥ÎîîÏÑú Î®πÏñ¥Î≥∏ Ï†Å ÏóÜÎäî ÏÉâÎã§Î•∏ ÎßõüòÜ ÌöåÏãùÌïòÍ∏∞ÏóêÎèÑ ÎÑò Ï¢ãÏïÑÏöî „Öé„Öé',
        user: 'Í∞êÏûêÎπµÎπµ/Í∏ÄÎ°úÎ≤åÎ¶¨ÎçîÌïôÎ∂Ä',
        id: 261,
        rating: 5,
    },
]; 

const MagazineContainer = styled.div`
  /* Îç∞Ïä§ÌÅ¨ÌÜ±ÏóêÏÑú Ïä§ÌÅ¨Î°§ Î∞îÎ•º Ïà®ÍπÄ */
  ::-webkit-scrollbar {
    display: none;
  }
  /* Î™®Î∞îÏùºÏóêÏÑú Ïä§ÌÅ¨Î°§ Î∞îÎ•º Ïà®ÍπÄ */
  *::-webkit-scrollbar {
    display: none;
  }
`;

const UpperBar = dynamic(() => import('../components/UpperBar'));

const Magazine = () => {
    const dispatch = useDispatch();
    const router = useRouter();

    const [reviewNum, setReviewNum] = useState(0);
    const [toggleInfo, setToggleInfo] = useState(null);

    const user = useSelector(state => state.auth.user);
    const toggle = useSelector(state => state.auth.toggle_for_not_user);
    const rank = useSelector(state => state.rank.rank);

    useEffect(()=>{
        dispatch(clear_search_results());
    },[])

    useEffect(() => {
        if (user) {
            dispatch(load_rank(user.toggle));
            setToggleInfo(user.toggle);
        } else if (toggle) {
            dispatch(load_rank(toggle));
            setToggleInfo(toggle);
        }
    },[user, toggle])
    
    const handlePrev = () => {
        setReviewNum((prevIndex) =>
        prevIndex === 0 ? reviewM.length - 1 : prevIndex - 1
        );
    };
    
    const handleNext = () => {
        setReviewNum((prevIndex) =>
        prevIndex === reviewM.length - 1 ? 0 : prevIndex + 1
        );
    };

    return(
        <ThemeProvider theme={theme}>
        <CssBaseline />
            <UpperBar />
            <Grid style={{overflowX:'hidden'}}>

                {/* ÏãùÎãπTOP5 */}
                <div className='top' style={{height:'270px'}}>
                    <div style={{ display: "flex", margin:'21px 0px 0px 15px' }}>
                        <Typography style={{ marginRight: "8px", fontSize:'16px',  fontWeight:'700' }} color="#2E2E2E">4Ïõî 1Ï£ºÏ∞® ÏãùÎãπ</Typography>
                        <Typography style={{ marginRight: "8px", fontSize:'16px',  fontWeight:'700' }} color={theme.palette.primary.main}>TOP 5</Typography>
                        <Typography>üî•</Typography>
                    </div>
                    <div style={{margin:'5px 0px 21px 15px'}}>
                        <Typography color={theme.palette.fontColor.light} style={{fontSize:'11px'}}>ÏùºÏ£ºÏùºÎßàÎã§ ÏóÖÎç∞Ïù¥Ìä∏ ÎèºÏöî!</Typography>
                    </div>
                    <MagazineContainer>
                        <div style={{margin:'0px 0px 0px 15px'}}>
                            <Grid container style={{  position: 'absolute', zIndex: '3', overflowX: 'auto', whiteSpace: 'nowrap', flexWrap: 'nowrap', width: window.innerWidth <= 375 ? 360 : window.innerWidth <= 400  ? 375 :  400, }}>
                                {rank && rank.map((item, index) => (
                                    <Grid item style={{display:'inline-block', flexShrink: 0, paddingRight: '9px'}} onClick={()=>{router.push(`/place?id=${item.place_id}`)}} >
                                        <div >
                                            {/* ÏãùÎãπÏù¥ÎØ∏ÏßÄ */}
                                            <div style={{display: 'flex', margin:'9px 0px 0px 9px', paddingTop:'2px',position:'absolute',zIndex:'3', alignItems: 'center', justifyContent: 'center', width: '23px', height: '21.41px', borderRadius: '50%', backgroundColor: index === 3 || index === 4 ? 'rgba(186, 186, 186, 0.7)' : 'rgba(255, 206, 0, 0.7)', color:'#fff', fontSize: '13px', fontWeight: 'bold'}}>
                                                {index+1}
                                            </div>
                                            <Image 
                                                src={item.image ? item.image : food} 
                                                width={155} 
                                                height={155} 
                                                layout='fixed' 
                                                placeholder='blur' 
                                                blurDataURL='data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mO8UA8AAiUBUcc3qzwAAAAASUVORK5CYII='
                                                style={{borderRadius:'20px', position:'relative'}}>
                                            </Image>
                                            {/* ÏãùÎãπÏù¥Î¶Ñ */}
                                            <Typography style={{fontSize:'15px', fontWeight:'700'}} color="#2E2E2E">{item.place_name}</Typography>
                                            {/* ÏãùÎãπÌèâÏ†ê */}
                                            <div style={{ display: "flex"}}>
                                                <Typography style={{fontSize:'10px', fontWeight:'400'}} color="#2E2E2E">Ïä§Íæ∏Ïπú ÌèâÏ†ê: &nbsp;</Typography>
                                                <Image src={filledStar} width={15} height={15} style={{margin:''}}/>
                                                <Typography style={{fontSize:'10px', fontWeight:'700'}} color="#2E2E2E">&nbsp; {item.rate}</Typography>
                                                <Typography style={{fontSize:'10px', fontWeight:'400'}} color="#2E2E2E">&nbsp;/ 5</Typography>
                                            </div>
                                        </div>
                                    </Grid>
                                ))}
                            </Grid>
                        </div>
                    </MagazineContainer>
                </div>

                {/* ÎßõÏßë ÏΩòÌÖêÏ∏† */}
                <div style={{margin:'45px 0px 0px 0px', position:'relative'}}>
                    <div style={{position:'absolute',zIndex:'3'}}>
                        {/* ÏïàÏóê ÏûêÏú†Î°≠Í≤å ÏàòÏ†ïÍ∞ÄÎä• */}
                        <Typography fontSize='12px' fontWeight='700' style={{margin:'23px 0px 0px 15px'}} color="white">Ïä§Íæ∏Ïπú ÎßàÏºÄÌÑ∞Ïùò ÌäπÎ≥ÑÌïú ÎßõÏßë Í∞ÄÏù¥Îìú</Typography>
                        <Typography fontSize='25px' fontWeight='700' style={{margin:'0px 0px 0px 15px'}} color={theme.palette.primary.main}>Î∞îÏÅòÎã§ Î∞îÎπ†, ÏãúÍ∞Ñ ÏóÜÏùÑ Îïå</Typography>
                        <Typography fontSize='25px' fontWeight='700' style={{margin:'0px 0px 0px 15px'}} color="white">Í∞ÑÎã®ÌïòÍ≤å Î®πÍ∏∞ Ï¢ãÏùÄ 8Í≥≥</Typography>
                    </div>
                    <div>
                        <div style={{position:'absolute',zIndex:'3', bottom:'8%', right: '3%', display: 'flex', justifyContent: 'space-between', alignItems: 'center',}}>
                            <Button style={{margin:'', fontSize:'12px', color:'white'}} onClick={()=>{router.push('/magazineDetail')}}>ÏΩòÌÖêÏ∏† Î≥¥Îü¨Í∞ÄÍ∏∞&nbsp;&nbsp; <Image src={arrow} width={15.57} height={15} layout='fixed'/></Button>
                        </div>
                        {/* <div style={{position:'absolute',zIndex:'3', bottom:'6%', left: '50%', transform: 'translateX(-50%)', display: 'flex', justifyContent: 'space-between', alignItems: 'center',}}>
                            <Image src={circles} width={50} height={6} layout='fixed' />
                        </div> */}
                    </div>
                    <div style={{position:'relative', width:'100%', height:'100%'}}>
                        <Image 
                            src={content} 
                            height={400}
                            width={431}
                            layout='fixed'
                            objectFit='cover'
                            placeholder='blur'
                            style={{ filter: 'brightness(0.6)' }}
                        />
                    </div>
                </div>

                {/* Î¶¨Î∑∞ */}
                <div style={{position:'relative', margin:'35px 0px 77px 0px' }}>
                    <div style={{ display: "flex",  margin:'0px 0px 0px 15px' }}>
                        <Typography style={{ marginRight: "8px", fontSize:'16px',  fontWeight:'700' }} color="#2E2E2E">ÏÑ±ÎåÄÏÉùÏùò</Typography>
                        <Typography style={{ marginRight: "8px", fontSize:'16px',  fontWeight:'700' }} color={theme.palette.primary.main}>Î¶¨Ïñº Î¶¨Î∑∞</Typography>
                        <Typography>üëÄ</Typography>
                    </div>
                    <div style={{margin:'16px 0px 0px 0px'}}>
                        <div style={{position:'absolute',zIndex:'3', display: 'flex', alignItems: 'center', justifyContent: 'center', top: 0, left: 0, right: 0, bottom: 0}}>
                            <div style={{textAlign: 'center'}}>
                                <div style={{margin:'23px 0px 0px 0px'}}>
                                {[1, 2, 3, 4, 5].map((item, index) => {
                                    let starImage = emptyStar;
                                    if (index + 1 <= reviewM[reviewNum].rating) {
                                        starImage = filledStar;
                                    }
                                    return (
                                        <Image key={index} width={21.72} height={22.43} src={starImage} alt='star' layout='fixed' />
                                    );
                                })}
                                </div>
                                <Typography fontSize='16px' fontWeight='700' style={{margin:'15px 0px 0px 0px'}} color="white" maxWidth={237}>"{toggleInfo && toggleInfo === 'Î™ÖÎ•ú' ? reviewM[reviewNum].text: reviewY[reviewNum].text}"</Typography>
                                <Typography fontSize='12px' fontWeight='400' style={{margin:'15px 0px 0px 0px'}} color="white" maxWidth={237}>{toggleInfo && toggleInfo === 'Î™ÖÎ•ú'? reviewM[reviewNum].user :  reviewY[reviewNum].user}</Typography>
                            </div>
                        </div>

                        <div>
                            <div style={{position:'absolute',zIndex:'3', bottom: '6%', right: '3%', display: 'flex', justifyContent: 'space-between', alignItems: 'center',}}>
                                <Button style={{margin:'', fontSize:'12px'}} onClick={()=>{toggleInfo && toggleInfo === 'Î™ÖÎ•ú'? router.push(`/place?id=${reviewM[reviewNum].id}`) : router.push(`/place?id=${reviewY[reviewNum].id}`)}}>Ïù¥ ÏãùÎãπ Ïñ¥ÎîîÏùºÍπå?&nbsp;&nbsp; <Image src={arrowY} width={15.57} height={15}/></Button>
                            </div>
                        </div>
                        <div>
                            <div style={{position:'absolute',zIndex:'3', display: 'flex', alignItems: 'center', justifyContent: 'center', left: "0%", top: '50%', transform: 'translateY(-50%)'}}>
                                <Button onClick={handlePrev}><Image src={arrowL} width={10.29} height={18.48} layout='fixed' /></Button>
                            </div>
                        </div>
                        <div>
                            <div style={{position:'absolute',zIndex:'3', display: 'flex', justifyContent: 'center', alignItems: 'center', right: "0%",top: '50%', transform: 'translateY(-50%)'}}>
                                <Button onClick={handleNext}><Image src={arrowR} width={10.29} height={18.48} layout='fixed' /></Button>
                            </div>
                        </div>
                        <div style={{position:'relative', width:'100%', height:'100%'}}>
                            <Image 
                                src={toggleInfo && toggleInfo === 'Î™ÖÎ•ú'? reviewM[reviewNum].src : reviewY[reviewNum].src}
                                height={250}
                                width={431}
                                layout='fixed'
                                objectFit='cover'
                                placeholder='blur'
                                style={{ filter: 'brightness(0.6)' }}
                            />
                        </div>
                    </div>
                </div>
            </Grid>
        </ThemeProvider>
    )
} 

export default dynamic(() => Promise.resolve(Magazine), {
    ssr: false,
});